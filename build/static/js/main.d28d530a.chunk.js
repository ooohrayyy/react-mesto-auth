(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{16:function(e,t,a){},17:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a(1),o=a.n(i),c=a(7),s=a.n(c),l=a(10),u=a(2),r=a(3),d=a(8),p=a(9),j=new(function(){function e(t){Object(d.a)(this,e),this._baseUrl=t.baseUrl,this._token=t.authorization,this.deleteCard=this.deleteCard.bind(this),this.toggleLike=this.toggleLike.bind(this)}return Object(p.a)(e,[{key:"_checkResponseData",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}},{key:"fetchUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:{authorization:this._token}}).then((function(t){return e._checkResponseData(t)}))}},{key:"fetchInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"GET",headers:{authorization:this._token}}).then((function(t){return e._checkResponseData(t)}))}},{key:"patchUserInfo",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.description})}).then((function(e){return t._checkResponseData(e)}))}},{key:"postCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._checkResponseData(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token}}).then((function(e){return t._checkResponseData(e)}))}},{key:"toggleLike",value:function(e,t){var a=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:{authorization:this._token}}).then((function(e){return a._checkResponseData(e)}))}},{key:"updateAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return t._checkResponseData(e)}))}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-19",authorization:"21765504-482c-4ec0-96f1-ca3e4078b259"}),b=a.p+"static/media/logo.a307e1c4.svg";var f=function(){return Object(n.jsx)("header",{className:"header container__header",children:Object(n.jsx)("img",{className:"header__logo",src:b,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f Mesto"})})},h=o.a.createContext();var m=function(e){var t=o.a.useContext(h),a=o.a.useState(!1),i=Object(r.a)(a,2),c=i[0],s=i[1],l=e.item;l.alt=l.name,l.caption="".concat(l.alt," / \xa9 ").concat(l.owner.name),l.isOwn=l.owner._id===t._id,l.isLiked=l.likes.some((function(e){return e._id===t._id}));var u="card__like ".concat(l.isLiked?"card__like_active":"");return o.a.useEffect((function(){s(!1)}),[e]),Object(n.jsxs)("article",{className:"card",children:[Object(n.jsx)("button",{className:"card__open-fullpic",type:"button",onClick:function(){e.onCardClick(l)},children:Object(n.jsx)("img",{className:"card__image",src:l.link,alt:l.alt})}),l.isOwn&&Object(n.jsx)("button",{className:"card__delete",type:"button",onClick:function(){e.onCardDelete(l)}}),Object(n.jsxs)("div",{className:"card__label",children:[Object(n.jsx)("h2",{className:"card__name",children:l.name}),!c&&Object(n.jsx)("button",{className:u,type:"button",onClick:function(){s(!0),e.onCardLike(l)},children:Object(n.jsx)("p",{className:"card__counter",children:l.likes.length})}),c&&Object(n.jsx)("button",{className:"card__loader",disabled:!0})]})]},e.i)},_=a.p+"static/media/avatar-loader.07e847c1.svg";var O=function(e){var t=o.a.useContext(h);return Object(n.jsxs)("main",{className:"main container__main",children:[Object(n.jsxs)("section",{className:"profile main__profile",children:[Object(n.jsxs)("div",{className:"profile__main",children:[Object(n.jsx)("img",{className:"profile__avatar",src:t.avatar||_,alt:"\u041f\u043e\u0440\u0442\u0440\u0435\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"}),Object(n.jsx)("button",{className:"profile__avatar-button",onClick:e.onEditAvatar}),Object(n.jsxs)("div",{className:"profile__text-info",children:[Object(n.jsx)("h1",{className:"profile__name",children:t.name||"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."}),Object(n.jsx)("button",{className:"profile__edit",type:"button",onClick:e.onEditProfile}),Object(n.jsx)("p",{className:"profile__description",children:t.about||"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435"})]})]}),Object(n.jsx)("button",{className:"profile__add",type:"button",onClick:e.onAddPlace})]}),Object(n.jsx)("section",{className:"cards main__cards",children:e.cards.map((function(t){return Object(n.jsx)(m,{item:t,onCardClick:e.onCardClick,onCardDelete:e.onCardDelete,onCardLike:e.onCardLike},t._id)}))})]})};var g=function(){return Object(n.jsx)("footer",{className:"footer container__footer",children:Object(n.jsx)("p",{className:"footer__text",children:"\xa9 2021 Mesto Russia"})})},v=a.p+"static/media/popup-loader.1f235894.svg",C=a.p+"static/media/popup-error.e597a708.svg";var x=function(e){return Object(n.jsxs)("div",{className:"popup__message popup-message ".concat("delete"===e.name?"popup-message_delete":""),children:[Object(n.jsx)("img",{className:"popup-message__img",src:e.state.loading?v:C,alt:"\u0418\u043b\u043b\u044e\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"}),Object(n.jsx)("h3",{className:"popup-message__text",children:e.state.loading?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...":e.state.message})]})};var k=function(e){var t=e.state,a=t.open,n=t.loading,i=t.failed,c=e.onClose,s=o.a.useCallback((function(){return!n&&!i}),[n,i]),l=o.a.useCallback((function(e){"Escape"===e.key&&s()&&c()}),[s,c]),u=o.a.useCallback((function(e){e.target.classList.contains("popup")&&s()&&c()}),[s,c]),r=o.a.useCallback((function(){document.addEventListener("keydown",l),document.addEventListener("click",u)}),[l,u]),d=o.a.useCallback((function(){document.removeEventListener("keydown",l),document.removeEventListener("click",u)}),[l,u]);o.a.useEffect((function(){return a&&r(),function(){a&&d()}}),[a,r,d])};var y=function(e){return k(e),Object(n.jsx)("div",{className:"popup popup-".concat(e.name," root__popup ").concat(e.state.open?"popup_opened":""),children:Object(n.jsxs)("form",{className:"popup__container",name:e.name,noValidate:!0,onChange:function(t){e.onFormValidityChange(t.currentTarget.checkValidity())},onSubmit:e.onSubmit,children:[!e.state.loading&&!e.state.failed&&Object(n.jsx)("button",{className:"popup__close",type:"button",onClick:e.onClose}),e.state.failed&&Object(n.jsx)("button",{className:"popup__refresh",type:"button",onClick:function(){window.location.reload()}}),Object(n.jsx)("h2",{className:"popup__heading ".concat("delete"===e.name?"popup__heading_delete":""),children:e.heading}),!e.state.loading&&!e.state.failed&&e.children,!e.state.loading&&!e.state.failed&&Object(n.jsx)("button",{className:"popup__button ".concat("delete"===e.name?"popup__button_type_delete":""),type:"submit",disabled:!e.formValidityState,children:"delete"===e.name?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}),(e.state.loading||e.state.failed)&&Object(n.jsx)(x,{name:e.name,state:e.state,message:e.message})]})})};var S=function(e){var t=o.a.useState(""),a=Object(r.a)(t,2),i=a[0],c=a[1];return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("input",{className:"popup__input ".concat(e.inputModifier," ").concat(e.inputValidityState?"":"popup__input_invalid"),type:e.inputType,name:e.inputName,value:e.inputValue,placeholder:e.inputPlaceholder,minLength:"2",maxLength:e.inputMaxLength,autoComplete:"off",required:!0,onChange:function(t){e.onValueChange(t),e.onInputValidityChange(t.target.validity.valid),c(t.target.validationMessage)}}),!e.inputValidityState&&Object(n.jsx)("span",{className:"popup__input-error",children:i})]})};var N=function(e){var t=o.a.useState(""),a=Object(r.a)(t,2),i=a[0],c=a[1],s=o.a.useState(!1),l=Object(r.a)(s,2),u=l[0],d=l[1],p=o.a.useState(!0),j=Object(r.a)(p,2),b=j[0],f=j[1];return Object(n.jsx)(y,{state:e.state,formValidityState:u,onFormValidityChange:d,name:"avatar",heading:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",onSubmit:function(t){t.preventDefault(),e.onUpdateAvatar(i),c(""),f(!0),d(!1)},onClose:function(){e.onClose(),c(""),f(!0),d(!1)},children:Object(n.jsx)(S,{inputModifier:"popup__input_avatar",inputName:"avatar",inputValue:i,inputType:"url",inputPlaceholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0444\u043e\u0442\u043e",inputValidityState:b,onInputValidityChange:f,onValueChange:function(e){c(e.target.value)}})})};var V=function(e){var t=o.a.useContext(h),a=o.a.useState(""),i=Object(r.a)(a,2),c=i[0],s=i[1],l=o.a.useState(""),u=Object(r.a)(l,2),d=u[0],p=u[1],j=o.a.useState(!0),b=Object(r.a)(j,2),f=b[0],m=b[1],_=o.a.useState(!0),O=Object(r.a)(_,2),g=O[0],v=O[1],C=o.a.useState(!0),x=Object(r.a)(C,2),k=x[0],N=x[1];return o.a.useEffect((function(){s(t.name),p(t.about)}),[t]),Object(n.jsxs)(y,{state:e.state,formValidityState:f,onFormValidityChange:m,name:"profile",heading:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,description:d}),m(!0)},onClose:function(){e.onClose(),s(t.name),p(t.about),v(!0),N(!0),m(!0)},children:[Object(n.jsx)(S,{inputModifier:"popup__input_name",inputType:"text",inputName:"name",inputValue:c,inputPlaceholder:"\u0418\u043c\u044f",inputMaxLength:"40",inputValidityState:g,onInputValidityChange:v,onValueChange:function(e){s(e.target.value)}}),Object(n.jsx)(S,{inputModifier:"popup__input_description",inputType:"text",inputName:"description",inputValue:d,inputPlaceholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",inputMaxLength:"200",inputValidityState:k,onInputValidityChange:N,onValueChange:function(e){p(e.target.value)}})]})};var L=function(e){var t=o.a.useState(""),a=Object(r.a)(t,2),i=a[0],c=a[1],s=o.a.useState(""),l=Object(r.a)(s,2),u=l[0],d=l[1],p=o.a.useState(!1),j=Object(r.a)(p,2),b=j[0],f=j[1],h=o.a.useState(!0),m=Object(r.a)(h,2),_=m[0],O=m[1],g=o.a.useState(!0),v=Object(r.a)(g,2),C=v[0],x=v[1];return Object(n.jsxs)(y,{state:e.state,formValidityState:b,onFormValidityChange:f,name:"card",heading:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",onSubmit:function(t){t.preventDefault(),e.onAddPlaceSubmit({name:i,link:u}),c(""),d(""),O(!0),x(!0),f(!1)},onClose:function(){e.onClose(),c(""),d(""),O(!0),x(!0),f(!1)},children:[Object(n.jsx)(S,{inputModifier:"popup__input_card-name",inputType:"text",inputName:"place",inputValue:i,inputPlaceholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",inputMaxLength:"30",inputValidityState:_,onInputValidityChange:O,onValueChange:function(e){c(e.target.value)}}),Object(n.jsx)(S,{inputModifier:"popup__input_card-link",inputType:"url",inputName:"link",inputValue:u,inputPlaceholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",inputValidityState:C,onInputValidityChange:x,onValueChange:function(e){d(e.target.value)}})]})};var T=function(e){return Object(n.jsx)(y,{state:e.state,formValidityState:e.initialValidityState,name:"delete",heading:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onSubmit:function(t){t.preventDefault(),e.onDeleteConfirmation(e.card)},onClose:e.onClose})};var E=function(e){return k(e),Object(n.jsx)("div",{className:"popup popup-fullpic root__popup ".concat(e.state.open?"popup_opened":""),children:Object(n.jsxs)("figure",{className:"popup__figure",children:[e.card&&Object(n.jsx)("button",{className:"popup__close popup__close_fullpic",type:"button",onClick:e.onClose}),Object(n.jsx)("img",{className:"popup__fullpic",src:e.card?e.card.link:null,alt:e.card?e.card.alt:null}),Object(n.jsx)("figcaption",{className:"popup__caption",children:e.card?e.card.caption:null})]})})};var D=function(){var e=o.a.useState({name:"",about:""}),t=Object(r.a)(e,2),a=t[0],i=t[1],c=o.a.useState([]),s=Object(r.a)(c,2),d=s[0],p=s[1],b=o.a.useState({}),m=Object(r.a)(b,2),_=m[0],v=m[1],C=o.a.useState({open:!1,loading:!1,failed:!1,message:null}),x=Object(r.a)(C,2),k=x[0],y=x[1],S=o.a.useState({open:!1,loading:!1,failed:!1,message:null}),D=Object(r.a)(S,2),U=D[0],P=D[1],I=o.a.useState({open:!1,loading:!1,failed:!1,message:null}),M=Object(r.a)(I,2),A=M[0],w=M[1],z=o.a.useState({open:!1,loading:!1,failed:!1,message:null}),F=Object(r.a)(z,2),R=F[0],J=F[1],B=o.a.useState({open:!1,loading:!1,failed:!1,message:null}),G=Object(r.a)(B,2),H=G[0],q=G[1];function K(){y(Object(u.a)(Object(u.a)({},k),{},{open:!1})),P(Object(u.a)(Object(u.a)({},U),{},{open:!1})),w(Object(u.a)(Object(u.a)({},A),{},{open:!1})),J(Object(u.a)(Object(u.a)({},R),{},{open:!1})),q(Object(u.a)(Object(u.a)({},H),{},{open:!1})),v(null)}return o.a.useEffect((function(){j.fetchUserInfo().then((function(e){i(e)})).catch((function(e){return console.log(e)}))}),[]),o.a.useEffect((function(){j.fetchInitialCards().then((function(e){p(e)})).catch((function(e){return console.log(e)}))}),[]),Object(n.jsxs)(h.Provider,{value:a,children:[Object(n.jsxs)("div",{className:"container root__container",children:[Object(n.jsx)(f,{}),Object(n.jsx)(O,{cards:d,onEditAvatar:function(){y(Object(u.a)(Object(u.a)({},k),{},{open:!0}))},onEditProfile:function(){P(Object(u.a)(Object(u.a)({},U),{},{open:!0}))},onAddPlace:function(){w(Object(u.a)(Object(u.a)({},A),{},{open:!0}))},onCardClick:function(){v(this.item),q(Object(u.a)(Object(u.a)({},H),{},{open:!0}))},onCardDelete:function(){v(this.item),J(Object(u.a)(Object(u.a)({},R),{},{open:!0}))},onCardLike:function(e){j.toggleLike(e._id,e.isLiked).then((function(t){var a=d.map((function(a){return a._id===e._id?t:a}));p(a)})).catch((function(e){console.log(e)}))}}),Object(n.jsx)(g,{})]}),Object(n.jsx)(V,{state:U,initialValidityState:!0,onUpdateUser:function(e){P(Object(u.a)(Object(u.a)({},U),{},{loading:!0})),j.patchUserInfo(e).then((function(e){i(e),setTimeout((function(){P(Object(u.a)(Object(u.a)({},U),{},{open:!1,loading:!1}))}),400),K()})).catch((function(e){console.log(e),P(Object(u.a)(Object(u.a)({},U),{},{loading:!1,failed:!0,message:e}))}))},onClose:K}),Object(n.jsx)(N,{state:k,initialValidityState:!1,onUpdateAvatar:function(e){y(Object(u.a)(Object(u.a)({},k),{},{loading:!0})),j.updateAvatar(e).then((function(e){i(e),setTimeout((function(){y(Object(u.a)(Object(u.a)({},k),{},{open:!1,loading:!1}))}),400),K()})).catch((function(e){console.log(e),y(Object(u.a)(Object(u.a)({},k),{},{loading:!1,failed:!0,message:e}))}))},onClose:K}),Object(n.jsx)(L,{state:A,initialValidityState:!1,onAddPlaceSubmit:function(e){w(Object(u.a)(Object(u.a)({},A),{},{loading:!0})),j.postCard(e).then((function(e){p([e].concat(Object(l.a)(d))),setTimeout((function(){w(Object(u.a)(Object(u.a)({},A),{},{open:!1,loading:!1}))}),400),K()})).catch((function(e){console.log(e),w(Object(u.a)(Object(u.a)({},A),{},{loading:!1,failed:!0,message:e}))}))},onClose:K}),Object(n.jsx)(T,{card:_,state:R,initialValidityState:!0,onDeleteConfirmation:function(e){J(Object(u.a)(Object(u.a)({},R),{},{loading:!0})),j.deleteCard(e._id).then((function(t){var a=d.filter((function(t){return t._id!==e._id}));p(a),setTimeout((function(){J(Object(u.a)(Object(u.a)({},R),{},{open:!1,loading:!1}))}),400),K()})).catch((function(e){console.log(e),J(Object(u.a)(Object(u.a)({},R),{},{loading:!1,failed:!0,message:e}))}))},onClose:K}),Object(n.jsx)(E,{card:_,state:H,onClose:K})]})},U=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,18)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,o=t.getLCP,c=t.getTTFB;a(e),n(e),i(e),o(e),c(e)}))};a(16);s.a.render(Object(n.jsx)(o.a.StrictMode,{children:Object(n.jsx)(D,{})}),document.getElementById("root")),U()}},[[17,1,2]]]);
//# sourceMappingURL=main.d28d530a.chunk.js.map